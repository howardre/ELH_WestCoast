---
title: "Prerecruit Data Exploration"
author: "Rebecca Howard"
output: html_document
---

```{r setup, include=FALSE}
library(here)
library(tidyverse)
```

Functions
```{r}
species_filter <- function(data, species){
  data %>%
    select(c('cruise', 'date', 'year', 'month',
             'day', 'tow_depth', 'latitude', 
             'longitude', 'surface_temp', 
             species)) %>%
    rename(larval_count = species) %>%
    mutate(larval_count = ifelse(is.na(larval_count), 0, larval_count)) %>%
    mutate(larval_count = as.numeric(as.character(larval_count)))
  }
```

Load data
```{r}
# Divide up the prerecruit data
juveniles <- read.csv(here('data', 'Prerecruit_full.csv')) %>%
  filter(program == 'PRS_juveniles') %>%
    select(c('cruise', 'date', 'year', 'month',
           'day', 'tow_depth', 'latitude', 'longitude',
           'scientific_name', 'larvae_count',
           'surface.temp..oc.', 'maturity')) %>% # begins in 2011
  rename(surface_temp = surface.temp..oc.)

larvae <- read.csv(here('data', 'Prerecruit_full.csv')) %>%
  filter(program == 'PRS_larvae') %>%
  select(c('cruise', 'date', 'year', 'month',
           'day', 'tow_depth', 'latitude', 'longitude',
           'scientific_name', 'larvae_count',
           'surface.temp..oc.', 'maturity')) %>% # begins in 2013
  rename(surface_temp = surface.temp..oc.)

# SPlit into species subsets
juveniles_wide <- juveniles %>% pivot_wider(names_from = scientific_name, 
                                            values_from = larvae_count,
                                            values_fn = list) %>%
  mutate(across(c(11:169), ~replace(., lengths(.) == 0, NA)))

juveniles_sanddab <- species_filter(juveniles_wide, 'Citharichthys sordidus')
juveniles_hake <- species_filter(juveniles_wide, 'Merluccius productus')
juveniles_anchovy <- species_filter(juveniles_wide, 'Engraulis mordax')
juveniles_widow <- species_filter(juveniles_wide, 'Sebastes entomelas')
juveniles_shortbelly <- species_filter(juveniles_wide, 'Sebastes jordani')



ctds <- read.csv(here('data', 'Prerecruit_env.csv'))[, -1]
```

